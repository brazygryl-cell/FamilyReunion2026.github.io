<<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Williams Family Reunion - Forum</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1>Williams Family Reunion Forum</h1>
  <button id="logout">Log Out</button>
</header>

<main id="forum-section">
  <p id="status"></p>
  
  <div id="forum-form">
    <input type="text" id="message" placeholder="Write a message">
    <button id="post">Post</button>
  </div>

  <ul id="messages"></ul>
</main>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase-init.js"></script> <!-- Your config file -->

<script>
const status = document.getElementById('status');
const logoutBtn = document.getElementById('logout');
const messageInput = document.getElementById('message');
const postBtn = document.getElementById('post');
const messagesList = document.getElementById('messages');

// Enforce login & approval
auth.onAuthStateChanged(user => {
  if(user){
    db.collection('approvedUsers').doc(user.email).get().then(doc => {
      if(doc.exists && doc.data().approved){
        status.textContent = `Logged in as ${user.email}`;
        loadMessages();
      } else {
        auth.signOut();
        window.location.href = "login.html";
      }
    });
  } else {
    window.location.href = "login.html";
  }
});

// Logout
logoutBtn.addEventListener('click', () => {
  auth.signOut();
  window.location.href = "login.html";
});

// Post a message
postBtn.addEventListener('click', () => {
  const msg = messageInput.value.trim();
  if(!msg) return;
  const user = auth.currentUser;
  db.collection('forum').add({
    email: user.email,
    message: msg,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  }).then(() => {
    messageInput.value = '';
  });
});

// Load all messages
function loadMessages(){
  db.collection('forum').orderBy('timestamp','asc').onSnapshot(snapshot => {
    messagesList.innerHTML = '';
    snapshot.forEach(doc => {
      const li = document.createElement('li');
      li.textContent = `${doc.data().email}: ${doc.data().message}`;
      messagesList.appendChild(li);
    });
  });
}
</script>
<footer>
  <p>Made with ❤️ by Taylor Clark Jones </p>
  <p> Art by 🔥 Andre Clark</p>
</footer>
</body>
</html>
