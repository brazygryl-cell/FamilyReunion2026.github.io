<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Family Forum</title>

  <link rel="stylesheet" href="style.css" />
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script type="module" src="nav.js"></script>

  <style>
    .tabs-container { display: flex; gap: 10px; margin-bottom: 20px; }
    .forum-tab { padding: 10px 16px; border-radius: 6px; cursor: pointer; background:#eee; }
    .forum-tab.active { background:#333; color:white; }

    #posts { max-width:800px; margin:auto; margin-top:20px; }
    .post { background:white; border-radius:6px; padding:12px; margin-bottom:14px; border:1px solid #ddd; }
    .meta { font-size:0.8em; color:#666; margin-top:6px; display:block; }

    #postBox { max-width:800px; margin:auto; margin-top:25px; }
    textarea { width:100%; height:120px; padding:10px; border-radius:6px; border:1px solid #bbb; background:white; color:black; }
    #submitPost { margin-top:10px; padding:8px 14px; border-radius:6px; cursor:pointer; }
  </style>

</head>
<body>
<header></header>

<section class="section">
  <div class="container">

    <h2>Family Forum</h2>
    <p>Talk, plan, and share updates.</p>

    <!-- Tabs -->
    <div class="tabs-container">
      <button class="forum-tab active" data-topic="general">General</button>
      <button class="forum-tab" data-topic="planning">Planning</button>
    </div>

    <!-- Post box -->
    <div id="postBox">
      <textarea id="postBody" placeholder="Write your message..."></textarea>
      <button id="submitPost">Post</button>
    </div>

    <!-- Posts -->
    <div id="posts">No posts yet.</div>

  </div>
</section>

<footer></footer>

<script>
const API = "/.netlify/functions/forum";

async function loadPosts() {
  try {
    const res = await fetch(API);
    const posts = await res.json();

    const container = document.getElementById("posts");
    container.innerHTML = posts.length ? "" : "No posts yet.";

    posts.forEach(post => {
      const div = document.createElement("div");
      div.className = "post";
      div.innerHTML = `
        <p>${post.body}</p>
        <span class="meta">â€” ${post.by}, ${new Date(post.createdAt).toLocaleString()}</span>
      `;
      container.appendChild(div);
    });
  } catch (err) {
    console.error("Failed to load posts:", err);
  }
}

document.getElementById("submitPost").addEventListener("click", async () => {
  const body = document.getElementById("postBody").value.trim();
  if (!body) return;

  const user = window.netlifyIdentity.currentUser();
  const email = user ? user.email : "anonymous";

  await fetch(API, {
    method: "POST",
    body: JSON.stringify({ body, email })
  });

  document.getElementById("postBody").value = "";
  loadPosts();
});

// Load posts on page open:
loadPosts();
</script>


</body>
</html>
