<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Family Forum</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header></header>

<h2 style="text-align:center;margin-top:1rem;">Family Forum ðŸ’¬</h2>

<div id="posts" style="max-width:700px;margin:1rem auto;"></div>

<div style="max-width:700px;margin:1.5rem auto;">
  <textarea id="postText" placeholder="Say something..." style="width:100%;height:90px;"></textarea>
  <button id="postBtn" style="margin-top:8px;width:100%;">Post</button>
</div>

<footer></footer>

<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<script type="module">
  import { loadNavbar, enableLogout, requireAuth } from "./nav.js";
  loadNavbar();
  enableLogout();
  requireAuth();

  async function loadPosts() {
    const res = await fetch("/api/forum");
    const posts = await res.json();
    const box = document.getElementById("posts");
    box.innerHTML = posts
      .map(p => `<div class="post"><strong>${p.by}</strong><br>${p.body}<br><small>${new Date(p.createdAt).toLocaleString()}</small></div>`)
      .join("");
  }

  async function createPost() {
    const user = netlifyIdentity.currentUser();
    if (!user) return netlifyIdentity.open("login");

    const email = user.email;
    const body = document.getElementById("postText").value.trim();
    if (!body) return;

    await fetch("/api/forum", {
      method: "POST",
      body: JSON.stringify({ body, email })
    });

    document.getElementById("postText").value = "";
    loadPosts();
  }

  document.getElementById("postBtn").addEventListener("click", createPost);
  loadPosts();
  setInterval(loadPosts, 4000); // live updates
</script>
</body>
</html>



