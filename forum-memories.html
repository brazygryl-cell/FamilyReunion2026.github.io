<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>General Chat - Williams Reunion</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1>POst your memories</h1>
  <nav>
    <a href="index.html">Home</a> |
    <a href="forum.html">Back to Boards</a>
  </nav>
</header>

<section id="board">
  <div id="posts"></div>
  <textarea id="new-post" placeholder="Write a message..."></textarea>
  <button onclick="postMessage()">Post</button>
</section>

<footer>
  <p>Made with ❤️ by Taylor Clark Jones</p>
</footer>

<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// 1️⃣ Netlify Identity
if (window.netlifyIdentity) {
  window.netlifyIdentity.init();
  const user = window.netlifyIdentity.currentUser();
  if (!user) window.location.href = "login.html";
}

// 2️⃣ Firebase setup
const firebaseConfig = {
  apiKey: "YOUR_FIREBASE_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const boardName = 'memories';

// 3️⃣ Load posts
db.ref('boards/' + boardName).on('value', snapshot => {
  const postsDiv = document.getElementById('posts');
  postsDiv.innerHTML = '';
  snapshot.forEach(child => {
    const msg = child.val();
    const p = document.createElement('p');
    p.innerHTML = `<strong>${msg.user}:</strong> ${msg.text}`;
    postsDiv.appendChild(p);
  });
});

// 4️⃣ Post new message
function postMessage() {
  const input = document.getElementById('new-post');
  const text = input.value.trim();
  if (!text) return;
  const user = window.netlifyIdentity.currentUser().email;
  db.ref('boards/' + boardName).push({ user, text });
  input.value = '';
}
</script>

</body>
</html>
